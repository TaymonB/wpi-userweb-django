# wpi-userweb-django
Template and deployment script for Django projects on Userweb at WPI.

## Features

* Serves your project over FastCGI using
  [flipflop](https://github.com/Kozea/flipflop), with .htaccess URL rewriting
  so that you have pretty URLs.
* Creates a Git repository on the CCC server for your project, with a
  post-receive hook that re-deploys it whenever you push to it. You can create
  a new project with this template, or clone to an existing repository. You can
  also have multiple deployments from the same Git repository, including from
  different branches.
* Uses Python 3.4, which is installed locally if necessary.
* Includes CAS authentication and integration with WPI's LDAP directory.
* Uses [twelve-factor-style configuration](http://12factor.net/config), with
  suitable initial settings stored in a .env file.
* Sets your database password to something with more entropy than the weak ones
  that the CCC generates for you.
* Enables all the Django features you'd expect, including flatpages and the
  sites framework.
* Serves everything over HTTPS, because _seriously it's the 21st century there's
  really no excuse not to do this._
* Sends email from your WPI address.
* Includes [HTML5 Boilerplate](https://html5boilerplate.com/).
* Provides a script to easily get you or someone else set up with a local
  deployment of your project on their own computer for development purposes.
  Just clone the repository and then run `python3.4 devstart.py`.

## Instructions

First,
[create a MySQL database on WPI's MySQL server](http://www.wpi.edu/academics/CCC/Services/Databases/MySQL.html).
Note that, if you submit the form and then log in through CAS, you'll get a
"Could not obtain action to be performed" error. Just go back and submit it
again, and it'll work the second time. Copy down the generated password.

Then ssh into ccc.wpi.edu (you can do this using PuTTY on Windows) and run the
following command, substituting the applicable command-line parameters:

    curl https://raw.githubusercontent.com/TaymonB/wpi-userweb-django/master/deploy.sh | bash -s -- [-o origin_url] [-b branch] [-w work_tree_dir] [-r repository_dir] [-p relative_path] db_name db_username db_password
    
Here is what the command-line parameters mean:

* `-s` tells Bash to read the script from stdin; it is not applicable to this
  script in particular.
* `-o origin_url` specifies the URL of the repository to clone from. If you're
  deploying an existing project that's on GitHub, Bitbucket, WPI FusionForge,
  etc., you want to use this. Note that the script makes certain assumptions
  about how your project is set up, so if it wasn't generated by this template
  it might not work right. If this parameter is omitted, a new project is
  generated from this template.
* `-b branch` specifies which branch of the repository to deploy. Defaults to
  `master`.
* `-w work_tree_dir` specifies the path to the directory where the project will
  be deployed to. If it doesn't exist, it will be created. This should **not**
  be a subdirectory of your `public_html`. Relative paths are interpreted from
  the current working directory, as usual. Defaults to the value of `db_name`
  (see below).
* `-r repository_dir` specifies the path to the Git repository on the CCC. If
  there's already a Git repository on this path, it will be used; otherwise,
  a new one will be created (from scratch or by cloning, depending on `-o`).
  Only an existing repository created with this script should be used in this
  way. The repository in question is a bare repository. Defaults to the path
  to the working tree with `.git` appended.
* `-p relative_path` specifies the URL where your project will be accessible.
  This must be given as a relative path. For example, if you are `someuser`
  and you specify `-p myproject`, the root URL for your project will be
  `https://users.wpi.edu/~someuser/myproject/`. By default, the project's root
  URL is the root URL of your web space.
* `db_name` is the name of the database you created.
* `db_username` is the username of the database user you created.
* `db_password` is the password that was generated when you created the
  database.

And that's how you do it.
